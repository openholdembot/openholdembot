<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0265)http://webcache.googleusercontent.com/search -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><HTML><HEAD>
<META content="text/html; charset=UTF-8" http-equiv="Content-Type">
<META name="GENERATOR" content="MSHTML 9.00.8112.16476"></HEAD>
<BODY class="mediawiki ns-0 ltr page-System_Wide_Mutex_Handling_-_Sample_Code">
<DIV style="background: rgb(255, 255, 255); margin: -1px -1px 0px; padding: 0px; border: 1px solid rgb(153, 153, 153);">
<DIV style="background: rgb(221, 221, 221); font: 13px/normal arial, sans-serif; margin: 12px; padding: 8px; border: 1px solid rgb(153, 153, 153); text-align: left; color: rgb(0, 0, 0); font-size-adjust: none; font-stretch: normal;">This 
is Google's cache of <A style="color: rgb(0, 0, 204); text-decoration: underline;" 
href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code">http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code</A>. 
It is a snapshot of the page as it appeared on Apr 16, 2013 15:26:45 GMT. The <A 
style="color: rgb(0, 0, 204); text-decoration: underline;" href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code">current 
page</A> could have changed in the meantime. <A style="color: rgb(0, 0, 204); text-decoration: underline;" 
href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222">Learn 
more</A><BR>Tip: To quickly find your search term on this page, press 
<B>Ctrl+F</B> or <B>⌘-F</B> (Mac) and use the find bar.<BR><BR>
<DIV style="float: right;"><A style="color: rgb(0, 0, 204); text-decoration: underline;" 
href="http://webcache.googleusercontent.com/search?q=cache:ez0HYAbZm_EJ:www.maxinmontreal.com/wiki/index.php5%3Ftitle%3DSystem_Wide_Mutex_Handling_-_Sample_Code+http://www.maxinmontreal.com/wiki/index.php5/System_Wide_Mutex_Handling_-_Sample_Code&amp;hl=en&amp;gl=us&amp;strip=1">Text-only 
version</A></DIV>
<DIV>&nbsp;</DIV></DIV></DIV>
<DIV style="position: relative;">
<META name="keywords" content="System Wide Mutex Handling - Sample Code"><LINK 
rel="shortcut icon" href="/favicon.ico"><LINK title="Maxin Wiki (English)" rel="search" 
type="application/opensearchdescription+xml" 
href="/wiki/opensearch_desc.php"><TITLE>System Wide Mutex Handling - Sample Code 
- Maxin Wiki</TITLE>
<STYLE type="text/css" media="screen, projection">/*<![CDATA[*/
			@import "/wiki/skins/common/shared.css?97";
			@import "/wiki/skins/monobook/main.css?97";
		/*]]>*/</STYLE>
<LINK rel="stylesheet" type="text/css" href="Systemwidemutexhandling_samplecode_files/commonPrint.css" 
media="print"><!--[if lt IE 5.5000]><style type="text/css">@import "/wiki/skins/monobook/IE50Fixes.css?97";</style><![endif]--><!--[if IE 5.5000]><style type="text/css">@import "/wiki/skins/monobook/IE55Fixes.css?97";</style><![endif]--><!--[if IE 6]><style type="text/css">@import "/wiki/skins/monobook/IE60Fixes.css?97";</style><![endif]--><!--[if IE 7]><style type="text/css">@import "/wiki/skins/monobook/IE70Fixes.css?97";</style><![endif]--><!--[if lt IE 7]><script type="text/javascript" src="/wiki/skins/common/IEFixes.js?97"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->
<SCRIPT type="text/javascript">/*<![CDATA[*/
var skin = "monobook";
var stylepath = "/wiki/skins";
var wgArticlePath = "/wiki/index.php5/$1";
var wgScriptPath = "/wiki";
var wgScript = "/wiki/index.php5";
var wgServer = "http://www.maxinmontreal.com";
var wgCanonicalNamespace = "";
var wgCanonicalSpecialPageName = false;
var wgNamespaceNumber = 0;
var wgPageName = "System_Wide_Mutex_Handling_-_Sample_Code";
var wgTitle = "System Wide Mutex Handling - Sample Code";
var wgAction = "view";
var wgRestrictionEdit = [];
var wgRestrictionMove = [];
var wgArticleId = "384";
var wgIsArticle = true;
var wgUserName = null;
var wgUserGroups = null;
var wgUserLanguage = "en";
var wgContentLanguage = "en";
var wgBreakFrames = false;
var wgCurRevisionId = "1228";
/*]]>*/</SCRIPT>

<SCRIPT type="text/javascript" src="Systemwidemutexhandling_samplecode_files/wikibits.js"><!-- wikibits js --></SCRIPT>

<SCRIPT type="text/javascript" src=""><!-- site js --></SCRIPT>

<STYLE type="text/css">/*<![CDATA[*/
@import "/wiki/index.php5?title=MediaWiki:Common.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/wiki/index.php5?title=MediaWiki:Monobook.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
@import "/wiki/index.php5?title=-&action=raw&gen=css&maxage=18000";
/*]]>*/</STYLE>
<!-- Head Scripts -->
<SCRIPT type="text/javascript" src="Systemwidemutexhandling_samplecode_files/ajax.js"></SCRIPT>

<DIV id="globalWrapper">
<DIV id="column-content">
<DIV id="content"><A id="top" name="top"></A>
<H1 class="firstHeading">System Wide Mutex Handling - Sample Code</H1>
<DIV id="bodyContent">
<H3 id="siteSub">From Maxin Wiki</H3>
<DIV id="contentSub"></DIV>
<DIV id="jump-to-nav">Jump to: <A href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code#column-one">navigation</A>, 
<A href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code#searchInput">search</A></DIV><!-- start content -->
<P>Below are 3 functions you'll need if you plan to avoid OH and hopper 
"collisions" over mouse and keyboard inputs. As you may know, OH ensures it can 
act on the table in a consistent manner by seizing control of mouse / keyboard 
input (system wide mutex), performing its actions (clicking buttons, entering 
text in swag field etc.) and then releasing mutex so other applications can 
perform their tasks.</P>
<P>This works fine as long as you run one or few OH instances, and do not have a 
very active hopper to manage them. Once you are past that point and start 
running many tables with as many OH instances, plus moving tables around, 
browsing lobby etc., a situation where OH may interfere with hopper operations 
in the middle of an important task occurs, resulting in very unpredictable 
behaviour.</P>
<P>To avoid such a possibility, you may want to implement mutex handling in your 
hopper using below code.</P>
<P><BR></P>
<P>The idea:</P>
<P><BR></P>
<OL>
  <LI>Create mutex lock at the start of your hopper. This seizes control of 
  keyboard / mouse and no other application can send any input using them until 
  mutex is released/unlocked.</LI>
  <LI>Find a good time in your hopper loop when game state is stable (no lobby 
  browsing, table opening / closing etc.) and release mutex for a period of time 
  (in my case this is (number of OH instances opened * 1) + 2 seconds). This 
  allows OH instances to grab mutex control for themselves, perform any pending 
  actions, and release mutex control again.</LI>
  <LI>Once the predetermined period of time expires, create mutex lock again, 
  and proceed with hopper operations knowing nothing can interfere with mouse / 
  keyboard.</LI>
  <LI>At the end of your hopper, release/unlock mutex.</LI></OL>
<P><BR></P>
<DL>
  <DT>START OF SAMPLE ****</DT></DL><PRE>  &nbsp;;START YOUR HOPPER, CREATE MUTEX LOCK
   MutexLock()
   $Global_Mutex_Handle = _CreateMutex("OHAntiColl")
  &nbsp;;ENTERING HOPPER LOOP
   While (1)
      &nbsp;;... HOPPER OPERATIONS
      &nbsp;;... GAME STATE STABLE, UNLOCK MUTEX
       MutexUnlock($Global_Mutex_Handle)
      &nbsp;;... WAIT FOR OH TO PERFORM ACTIONS
      &nbsp;;... TIME EXPIRED, CREATE MUTEX LOCK AGAIN
       MutexLock()
   wend
  &nbsp;;END OF HOPPER, RELEASE MUTEX
   MutexUnlock($Global_Mutex_Handle)
  &nbsp;;END OF HOPPER, CLOSE MUTEX HANDLE
   Close_Mutex_Handle($Global_Mutex_Handle)
</PRE>
<P><BR></P>
<DL>
  <DT>END OF SAMPLE ****</DT></DL>
<P><BR></P>
<P><BR></P>
<P><BR></P><PRE>   Func _CreateMutex($sOccurenceName)
       Local $ERROR_ALREADY_EXISTS = 183
       $Global_Mutex_Handle = DllCall("kernel32.dll", "int", "CreateMutex", "int", 0, "long", 1, "str", $sOccurenceName)
       $lastError = DllCall("kernel32.dll", "int", "GetLastError")
       If $lastError[0] = $ERROR_ALREADY_EXISTS Then
            Return SetError($lastError[0], $lastError[0], $Global_Mutex_Handle[0])
       EndIf
       Return SetError(0, 0, $Global_Mutex_Handle[0])
   EndFunc  &nbsp;;==&gt;_GetMutex
</PRE><PRE>   Func MutexUnlock($Global_Mutex_Handle)
       Local $releasemutex = DllCall("kernel32.dll", "int", "ReleaseMutex", "long", $Global_Mutex_Handle)
       If (IsArray($releasemutex) And $releasemutex[0] &gt; 0) Then Return 1
       Return 0
   EndFunc  &nbsp;;==&gt;_ReleaseMutex
</PRE><PRE>   Func Close_Mutex_Handle($hMutex)
       Local $aCH = DllCall("Kernel32.dll", "int", "CloseHandle", "hwnd", $Global_Mutex_Handle)
       If (IsArray($aCH) And $aCH[0] &gt; 0) Then Return 1
       Return 0
   EndFunc
</PRE><PRE>   Func _API_WaitForSingleObject($Global_Mutex_Handle, $dwMilliseconds)
       Local $aResult = DllCall("kernel32.dll", "long", "WaitForSingleObject", "long", $Global_Mutex_Handle, "long", $dwMilliseconds)
       Return $aResult[0]
   EndFunc  &nbsp;;==&gt;_API_WaitForSingleObject
</PRE><PRE>   Func MutexLock()
       While 1
               $Global_Mutex_Handle = _CreateMutex("OHAntiColl");
               If @error = 0 Then
                      &nbsp;;SUCCESSFULLY CREATED AND LOCKED MUTEX
                       ExitLoop
               Else
                      &nbsp;;WE WILL EXAMINE MUTEX TO SEE IF IT IS RELEASED
                       Local $result = _API_WaitForSingleObject($Global_Mutex_Handle, 30000); WAIT FOR MUTEX FOR 30 SECONDS
                       If $result = 0 Or $result = 128 Then
                              &nbsp;;SUCCESSFULLY LOCKED MUTEX
                               ExitLoop
                       EndIf
               EndIf
              &nbsp;;WAIT A BIT BEFORE TRYING AGAIN - WE ARE NOT PROCEEDING UNTIL WE HAVE CONTROL OF MUTEX
               Sleep(100)
       WEnd
   EndFunc&nbsp;;==&gt;MutexLock
</PRE><!-- Saved in parser cache with key maxin_wiki:pcache:idhash:384-0!1!0!!en!2 and timestamp 20130328001705 -->
<DIV class="printfooter">Retrieved from "<A href="http://www.maxinmontreal.com/wiki/index.php5/System_Wide_Mutex_Handling_-_Sample_Code">http://www.maxinmontreal.com/wiki/index.php5/System_Wide_Mutex_Handling_-_Sample_Code</A>"</DIV><!-- end content -->
<DIV class="visualClear"></DIV></DIV></DIV></DIV>
<DIV id="column-one">
<DIV id="p-cactions" class="portlet">
<H5>Views</H5>
<DIV class="pBody">
<UL>
  <LI id="ca-nstab-main" class="selected"><A accessKey="c" title="View the content page [c]" 
  href="http://www.maxinmontreal.com/wiki/index.php5/System_Wide_Mutex_Handling_-_Sample_Code">Article</A></LI>
  <LI id="ca-talk" class="new"><A accessKey="t" title="Discussion about the content page [t]" 
  href="http://www.maxinmontreal.com/wiki/index.php5?title=Talk:System_Wide_Mutex_Handling_-_Sample_Code&amp;action=edit">Discussion</A></LI>
  <LI id="ca-edit"><A accessKey="e" title="You can edit this page. Please use the preview button before saving. [e]" 
  href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code&amp;action=edit">Edit</A></LI>
  <LI id="ca-history"><A accessKey="h" title="Past versions of this page. [h]" 
  href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code&amp;action=history">History</A></LI></UL></DIV></DIV>
<DIV id="p-personal" class="portlet">
<H5>Personal tools</H5>
<DIV class="pBody">
<UL>
  <LI id="pt-login"><A accessKey="o" title="You are encouraged to log in, it is not mandatory however. [o]" 
  href="http://www.maxinmontreal.com/wiki/index.php5?title=Special:Userlogin&amp;returnto=System_Wide_Mutex_Handling_-_Sample_Code">Log 
  in / create account</A></LI></UL></DIV></DIV>
<DIV id="p-logo" class="portlet"><A style='background-image: url("/wiki/skins/common/images/wiki.png");' 
href="http://www.maxinmontreal.com/"></A></DIV>
<SCRIPT type="text/javascript"> if (window.isMSIE55) fixalpha(); </SCRIPT>

<DIV id="p-navigation" class="portlet">
<H5>Navigation</H5>
<DIV class="pBody">
<UL>
  <LI id="n-mainpage"><A accessKey="z" title="Visit the Main Page [z]" href="http://www.maxinmontreal.com/wiki/index.php5/Main_Page">Main 
  Page</A></LI>
  <LI id="n-portal"><A title="About the project, what you can do, where to find things" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Maxin_Wiki:Community_Portal">Community 
  portal</A></LI>
  <LI id="n-currentevents"><A title="Find background information on current events" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Current_events">Current 
  events</A></LI>
  <LI id="n-recentchanges"><A accessKey="r" title="The list of recent changes in the wiki. [r]" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Special:Recentchanges">Recent 
  changes</A></LI>
  <LI id="n-randompage"><A accessKey="x" title="Load a random page [x]" href="http://www.maxinmontreal.com/wiki/index.php5/Special:Random">Random 
  page</A></LI>
  <LI id="n-help"><A title="The place to find out." href="http://www.maxinmontreal.com/wiki/index.php5/Help:Contents">Help</A></LI>
  <LI id="n-sitesupport"><A title="Support us" href="http://www.maxinmontreal.com/wiki/index.php5/Maxin_Wiki:Site_support">Donations</A></LI></UL></DIV></DIV>
<DIV id="p-search" class="portlet">
<H5><LABEL for="searchInput">Search</LABEL></H5>
<DIV id="searchBody" class="pBody">
<FORM id="searchform" action="/wiki/index.php5/Special:Search">
<DIV><INPUT accessKey="f" id="searchInput" title="Search Maxin Wiki [f]" name="search" 
type="text"><INPUT id="searchGoButton" class="searchButton" name="go" value="Go" type="submit">&nbsp;
				<INPUT id="mw-searchButton" class="searchButton" name="fulltext" value="Search" type="submit"></DIV></FORM></DIV></DIV>
<DIV id="p-tb" class="portlet">
<H5>Toolbox</H5>
<DIV class="pBody">
<UL>
  <LI id="t-whatlinkshere"><A accessKey="j" title="List of all wiki pages that link here [j]" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Special:Whatlinkshere/System_Wide_Mutex_Handling_-_Sample_Code">What 
  links here</A></LI>
  <LI id="t-recentchangeslinked"><A accessKey="k" title="Recent changes in pages linked from this page [k]" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Special:Recentchangeslinked/System_Wide_Mutex_Handling_-_Sample_Code">Related 
  changes</A></LI>
  <LI id="t-upload"><A accessKey="u" title="Upload images or media files [u]" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Special:Upload">Upload 
  file</A></LI>
  <LI id="t-specialpages"><A accessKey="q" title="List of all special pages [q]" 
  href="http://www.maxinmontreal.com/wiki/index.php5/Special:Specialpages">Special 
  pages</A></LI>
  <LI id="t-print"><A accessKey="p" title="Printable version of this page [p]" 
  href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code&amp;printable=yes">Printable 
  version</A></LI>
  <LI id="t-permalink"><A title="Permanent link to this version of the page" 
  href="http://www.maxinmontreal.com/wiki/index.php5?title=System_Wide_Mutex_Handling_-_Sample_Code&amp;oldid=1228">Permanent 
  link</A></LI></UL></DIV></DIV></DIV><!-- end of the left (by default at least) column -->
<DIV class="visualClear"></DIV>
<DIV id="footer">
<DIV id="f-poweredbyico"><A href="http://www.mediawiki.org/"><IMG alt="Powered by MediaWiki" 
src="Systemwidemutexhandling_samplecode_files/poweredby_mediawiki_88x31.png"></A></DIV>
<UL id="f-list">
  <LI id="lastmod"> This page was last modified 03:28, 5 September 2008.</LI>
  <LI id="viewcount">This page has been accessed 3,709 times.</LI>
  <LI id="privacy"><A title="Maxin Wiki:Privacy policy" href="http://www.maxinmontreal.com/wiki/index.php5/Maxin_Wiki:Privacy_policy">Privacy 
  policy</A></LI>
  <LI id="about"><A title="Maxin Wiki:About" href="http://www.maxinmontreal.com/wiki/index.php5/Maxin_Wiki:About">About 
  Maxin Wiki</A></LI>
  <LI id="disclaimer"><A title="Maxin Wiki:General disclaimer" href="http://www.maxinmontreal.com/wiki/index.php5/Maxin_Wiki:General_disclaimer">Disclaimers</A></LI></UL></DIV>
<SCRIPT type="text/javascript">if (window.runOnloadHook) runOnloadHook();</SCRIPT>
</DIV><!-- Served in 0.115 secs. --></DIV></BODY></HTML>
